var can = [
    {
        name: 'absolutely_zero',
        value: 1,
        type: "",
        contry: "IT",
        image: "absolutely_zero.webp",
        title: "ABSOLUTELY ZERO",
        text: ""
    }, {
        name: 'assalt',
        value: 3,
        type: "",
        contry: "EN",
        image: "assalt.webp",
        title: "ASSALT",
        text: ""
    }, {
        name: 'energy',
        value: 1,
        type: "",
        contry: "IT",
        image: "energy.webp",
        title: "ENERGY",
        text: ""
    }, {
        name: 'import',
        value: 6,
        type: "",
        contry: "EN",
        image: "import.webp",
        title: "IMPORT",
        ext: ""
    }, {
        name: 'irish_blend',
        value: 1,
        type: "",
        contry: "",
        image: "irish_blend.webp",
        title: "IRISH BLEND",
        text: ""
    }, {
        name: 'kona_blend',
        value: 1,
        type: "",
        contry: "",
        image: "kona_blend.webp",
        title: "KONA BLEND",
        text: ""
    }, {
        name: 'loca_moca',
        value: 1,
        type: "",
        contry: "",
        image: "loca_moca.webp",
        title: "LOCA MOCA",
        text: ""
    }, {
        name: 'mango_loco',
        value: 1,
        type: "",
        contry: "",
        image: "mango_loco.webp",
        title: "MANGO LOCO",
        text: ""
    }, {
        name: 'mean_bean',
        value: 1,
        type: "",
        contry: "",
        image: "mean_bean.webp",
        title: "MEAN BEAN",
        text: ""
    }, {
        name: 'nitro',
        value: 1,
        type: "",
        contry: "",
        image: "nitro.webp",
        title: "NITRO",
        text: ""
    }, {
        name: 'pacific_punch',
        value: 1,
        type: "",
        contry: "",
        image: "pacific_punch.webp",
        title: "PACIFIC PUNCH",
        text: ""
    }, {
        name: 'papillon',
        value: 1,
        type: "",
        contry: "",
        image: "papillon.webp",
        title: "PAPILLON",
        text: ""
    }, {
        name: 'pipeline_punch',
        value: 1,
        type: "",
        contry: "",
        image: "pipeline_punch.webp",
        title: "PIPELINE PUNCH",
        text: ""
    }, {
        name: 'rehab',
        value: 1,
        type: "",
        contry: "",
        image: "rehab.webp",
        title: "REHAB",
        text: ""
    }, {
        name: 'reserve_watermelon',
        value: 1,
        type: "",
        contry: "",
        image: "reserve_watermelon.webp",
        title: "RESERVE WATERMELON",
        text: ""
    }, {
        name: 'ultra',
        value: 1,
        type: "",
        contry: "",
        image: "ultra.webp",
        title: "ULTRA",
        text: ""
    }, {
        name: 'ultra_black',
        value: 1,
        type: "",
        contry: "",
        image: "ultra_black.webp",
        title: "ULTRA BLACK",
        text: ""
    }, {
        name: 'ultra_blue',
        value: 1,
        type: "",
        contry: "",
        image: "ultra_blue.webp",
        title: "ULTRA BLUE",
        text: ""
    }, {
        name: 'ultra_fiesta_mango',
        value: 1,
        type: "",
        contry: "",
        image: "ultra_fiesta_mango.webp",
        title: "ULTRA FIESTA MANGO",
        text: ""
    }, {
        name: 'ultra_gold',
        value: 1,
        image: "ultra_gold.webp",
        title: "ULTRA GOLD",
        text: ""
    }, {
        name: 'ultra_paradise',
        value: 1,
        image: "ultra_paradise.webp",
        title: "ULTRA PARADISE",
        text: ""
    }, {
        name: 'ultra_peachy_keen',
        value: 1,
        image: "ultra_peachy_keen.webp",
        title: "ULTRA PEACHY KEEN",
        text: ""
    }, {
        name: 'ultra_red',
        value: 1,
        image: "ultra_red.webp",
        title: "ULTRA RED",
        text: ""
    }, {
        name: 'ultra_rosa',
        value: 1,
        image: "ultra_rosa.webp",
        title: "ULTRA ROSA",
        text: ""
    }, {
        name: 'ultra_bsunrise',
        value: 1,
        image: "ultra_sunribe.webp",
        title: "ULTRA SUNRISE",
        text: ""
    }, {
        name: 'ultra_violet',
        value: 1,
        image: "ultra_violet.webp",
        title: "ULTRA VIOLET",
        text: ""
    }, {
        name: 'ultra_watermelon',
        value: 1,
        image: "ultra_watermelon.webp",
        title: "ULTRA WATERMELON",
        text: ""
    }, {
        name: 'vanilla_light',
        value: 1,
        image: "vanilla_light.webp",
        title: "VANILLA LIGHT",
        text: ""
    }, {
        name: 'vr46',
        value: 1,
        image: "vr46.webp",
        title: "VR46",
        text: ""
    }, {
        name: 'white_pineapple',
        value: 3,
        image: "white_pineapple.webp",
        title: "WHITE PINEAPPLE",
        text: ""
    }, {
        name: 'cosmic_peach',
        value: 3.5,
        image: "cosmic_peach.webp",
        title: "COSMIC PEACH",
        text: ""
    }, {
        name: 'zero_sugar',
        value: 1,
        image: "zero_sugar.webp",
        title: "ZERO SUGAR",
        text: ""
    }, {
        name: 'espresso_vanilla',
        value: 2,
        image: "espresso_vanilla.webp",
        title: "ESPRESSO VANILLA",
        text: ""
    }, {
        name: 'espresso',
        value: 2,
        image: "espresso.webp",
        title: "ESPRESSO",
        text: ""
    }, {
        name: 'ultra_fiesta',
        value: 2,
        image: "ultra_fiesta.webp",
        title: "ULTRA FIESTA",
        text: ""
    }, {
        name: 'aussie_lemonade',
        value: 2,
        image: "aussie_lemonade.webp",
        title: "ASSIE LEMONADE",
        text: ""
    }, {
        name: 'mixxd',
        value: 2,
        image: "mixxd.webp",
        title: "MIXXD",
        text: ""
    }, {
        name: 'khaotic',
        value: 2,
        image: "khaotic.webp",
        title: "KHAOTIC",
        text: ""
    }, {
        name: 'monarch',
        value: 2,
        image: "monarch.webp",
        title: "MONARCH",
        text: ""
    }, {
        name: 'ripper',
        value: 4,
        image: "ripper.webp",
        title: "RIPPER",
        text: ""
    }, {
        name: 'iced_tea_lemon',
        value: 2,
        image: "iced_tea_lemon.webp",
        title: "ICED TEA LEMON",
        text: ""
    }, {
        name: 'iced_tea_peach',
        value: 2,
        image: "iced_tea_peach.webp",
        title: "ICED TEA PEACH",
        text: ""
    }, {
        name: 'recover',
        value: 2,
        image: "recover.webp",
        title: "RECOVER",
        text: ""
    }, {
        name: 'lewis_hamilton_zero',
        value: 1,
        image: "lewis_hamilton_zero.webp",
        title: "LEWIS HAMILTON ZERO",
        text: ""
    }, {
        name: 'lewis_hamilton',
        value: 1,
        image: "lewis_hamilton.webp",
        title: "LEWIS HAMILTON",
        text: ""
    }, {
        name: 'salted_caramel',
        value: 1,
        image: "salted_caramel.webp",
        title: "SALTED CARAMEL",
        text: ""
    }, {
        name: 'ultra_golden',
        value: 1,
        image: "ultra_golden_pineapple.webp",
        title: "ULTRA GOLDEN PINEAPPLE",
        text: ""
    }, {
        name: 'ultra_citron',
        value: 1,
        image: "ultra_citron.webp",
        title: "ULTRA CITRON",
        text: ""
    }, {
        name: 'mule',
        value: 1,
        image: "mule.webp",
        title: "MULE",
        text: ""
    }, {
        name: 'extra_strength',
        value: 1,
        image: "extra_strength.webp",
        title: "EXTRA STRENGTH 3",
        text: ""
    }, {
        name: 'blue_ice',
        value: 3,
        image: "blue_ice.webp",
        title: "BLUE ICE",
        text: ""
    }, {
        name: 'wild_berry_tea',
        value: 6,
        image: "wild_berry_tea.webp",
        title: "WILD BERRY TEA",
        text: ""
    }, {
        name: 'm',
        value: 0,
        image: "waiting.webp",
        title: " ",
        text: ""
    }
];

// Funzione per inizializzare la collezione
function initializeCollection() {
    var count = 0;
    var value = 0;

    can.forEach(function (car) {
        // Crea elemento per la vista griglia
        var gridFragment = `
            <div class="card">
                <img src="images/waiting.webp" class="card-img-top" alt="..." id="grid-${car.image}">
                <div class="card-body">
                    <h5 class="card-text">${car.title}</h5>
                </div>
            </div>
        `;

        // Crea elemento per la vista lista
        var listFragment = `
            <div class="card">
                <img src="images/waiting.webp" class="card-img-top" alt="..." id="list-${car.image}">
                <div class="card-body">
                    <div class="card-text card-title">${car.title}</div>
                    <div class="card-text card-value">${car.value}</div>
                    <div class="card-text card-country">${car.contry || '-'}</div>
                </div>
            </div>
        `;

        // Aggiungi alla vista griglia
        var gridDiv = document.createElement('div');
        gridDiv.id = 'grid-' + car.name;
        gridDiv.className = 'col my-3';
        gridDiv.innerHTML = gridFragment;
        document.getElementById('row').appendChild(gridDiv);

        // Aggiungi alla vista lista
        var listDiv = document.createElement('div');
        listDiv.id = 'list-' + car.name;
        listDiv.className = 'col my-3';
        listDiv.innerHTML = listFragment;
        document.getElementById('row-list').appendChild(listDiv);

        // Carica le immagini per entrambe le viste
        ['grid-', 'list-'].forEach(prefix => {
            var img = document.getElementById(prefix + car.image);
            var imgPreload = new Image();
            imgPreload.onload = function() {
                img.src = 'images/' + car.image;
            };
            imgPreload.src = 'images/' + car.image;
        });

        count += 1;
        value += Number(car.value);
    });

    document.getElementById("stat").innerHTML = `Statistiche: ${count} Pezzi : ${value} Valore`;
}

// Funzione per gestire il cambio vista
function setupViewToggle() {
    const gridView = document.getElementById('grid-view');
    const listView = document.getElementById('list-view');
    const viewButtons = document.querySelectorAll('.view-toggle-btn');
    let currentView = 'grid';

    viewButtons.forEach(btn => {
        btn.addEventListener('click', () => {
            const view = btn.getAttribute('data-view');
            
            viewButtons.forEach(b => b.classList.remove('active'));
            
            btn.classList.add('active');
            
            if (view === 'grid') {
                gridView.style.display = 'block';
                listView.style.display = 'none';
                currentView = 'grid';
            } else {
                gridView.style.display = 'none';
                listView.style.display = 'block';
                currentView = 'list';
            }
            
            if (searchInput) {
                filterItems(searchInput.value);
            }
        });
    });
}

// Funzione separata per il filtro
function filterItems(searchTerm) {
    const currentView = document.querySelector('.view-toggle-btn.active').getAttribute('data-view');
    const container = currentView === 'grid' ? '#row' : '#row-list';
    
    // Seleziona tutti gli elementi con classe 'col my-3'
    const items = document.querySelectorAll(`${container} .col`);
    let visibleCount = 0;
    
    // Normalizza il termine di ricerca
    const normalizedSearchTerm = searchTerm.toLowerCase().trim();
    
    items.forEach(item => {
        // Selettore diverso in base alla vista
        const titleElement = currentView === 'grid' 
            ? item.querySelector('.card-body h5')
            : item.querySelector('.card-text.card-title');
        
        if (titleElement) {
            const title = titleElement.textContent.toLowerCase().trim();
            const shouldShow = normalizedSearchTerm === '' || title.includes(normalizedSearchTerm);
            
            item.style.display = shouldShow ? '' : 'none';
            if (shouldShow) {
                visibleCount++;
            }
        }
    });

    // Mostra un messaggio se non ci sono risultati
    const noResultsMessage = document.getElementById('noResultsMessage') || (() => {
        const msg = document.createElement('div');
        msg.id = 'noResultsMessage';
        msg.style.textAlign = 'center';
        msg.style.padding = '20px';
        msg.style.width = '100%';
        msg.style.display = 'none';
        document.querySelector(container).appendChild(msg);
        return msg;
    })();

    noResultsMessage.textContent = 'Nessun risultato trovato';
    noResultsMessage.style.display = visibleCount === 0 ? 'block' : 'none';
}

// Funzione per la ricerca
function setupSearch() {
    const searchInput = document.getElementById('searchInput');
    
    if (searchInput) {
        searchInput.addEventListener('input', (e) => {
            filterItems(e.target.value);
        });
    }
}

// Inizializzazione quando il DOM è caricato
document.addEventListener('DOMContentLoaded', function() {
    initializeCollection();
    setupViewToggle();  // Prima il setup delle viste
    setupSearch();      // Poi il setup della ricerca
    
    // Inizializza il Service Worker
    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('/sw.js')
            .then(function(registration) {
                // Registration successful
            })
            .catch(function(err) {
                // Registration failed
            });
    }
});
